From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Lo=C3=AFc=20Mangeonjean?= <loic@coderpad.io>
Date: Mon, 17 Nov 2025 18:08:38 +0100
Subject: [PATCH] fix: fix notebook layout when there is a header on top of the
 workbench

---
 src/vs/workbench/browser/media/style.css               |  1 -
 .../contrib/notebook/browser/notebookEditorWidget.ts   | 10 +++++-----
 2 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/src/vs/workbench/browser/media/style.css b/src/vs/workbench/browser/media/style.css
index 2970ec6e57f..985e731754b 100644
--- a/src/vs/workbench/browser/media/style.css
+++ b/src/vs/workbench/browser/media/style.css
@@ -39,7 +39,6 @@
 	line-height: 1.4em;
 	inset: 0;
 	color: var(--vscode-foreground);
-	position: relative;
 }
 
 .monaco-workbench.web .monaco-workbench-part, .monaco-workbench-part.web {
diff --git a/src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts b/src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts
index 494fff0e961..42522b793e8 100644
--- a/src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts
+++ b/src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts
@@ -1960,11 +1960,12 @@ export class NotebookEditorWidget extends Disposable implements INotebookEditorD
 		} else {
 			// We have to recompute position and size ourselves (which is slow)
 			const containerRect = shadowElement.getBoundingClientRect();
+			const elementContainerRect = this._overlayContainer.parentElement?.getBoundingClientRect();
 			this._shadowElementViewInfo = {
 				height: containerRect.height,
 				width: containerRect.width,
-				top: containerRect.top,
-				left: containerRect.left
+				top: containerRect.top - (elementContainerRect?.top || 0),
+				left: containerRect.left - (elementContainerRect?.left || 0)
 			};
 		}
 	}
@@ -1982,9 +1983,8 @@ export class NotebookEditorWidget extends Disposable implements INotebookEditorD
 			return;
 		}
 
-		const elementContainerRect = this._overlayContainer.parentElement?.getBoundingClientRect();
-		this._overlayContainer.style.top = `${this._shadowElementViewInfo.top - (elementContainerRect?.top || 0)}px`;
-		this._overlayContainer.style.left = `${this._shadowElementViewInfo.left - (elementContainerRect?.left || 0)}px`;
+		this._overlayContainer.style.top = `${this._shadowElementViewInfo.top}px`;
+		this._overlayContainer.style.left = `${this._shadowElementViewInfo.left}px`;
 		this._overlayContainer.style.width = `${dimension ? dimension.width : this._shadowElementViewInfo.width}px`;
 		this._overlayContainer.style.height = `${dimension ? dimension.height : this._shadowElementViewInfo.height}px`;
 	}
