From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Lo=C3=AFc=20Mangeonjean?= <loic@coderpad.io>
Date: Thu, 29 Jan 2026 15:04:25 +0100
Subject: [PATCH] feat: add terminal.integrated.preserveDrawingBuffer setting

---
 src/vs/platform/terminal/common/terminal.ts                  | 1 +
 .../contrib/terminal/browser/xterm/xtermTerminal.ts          | 3 ++-
 src/vs/workbench/contrib/terminal/common/terminal.ts         | 1 +
 .../contrib/terminal/common/terminalConfiguration.ts         | 5 +++++
 4 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/vs/platform/terminal/common/terminal.ts b/src/vs/platform/terminal/common/terminal.ts
index 3a5cb1f685a..eb222843351 100644
--- a/src/vs/platform/terminal/common/terminal.ts
+++ b/src/vs/platform/terminal/common/terminal.ts
@@ -100,6 +100,7 @@ export const enum TerminalSettingId {
 	PersistentSessionReviveProcess = 'terminal.integrated.persistentSessionReviveProcess',
 	HideOnStartup = 'terminal.integrated.hideOnStartup',
 	HideOnLastClosed = 'terminal.integrated.hideOnLastClosed',
+	PreserveDrawingBuffer = 'terminal.integrated.preserveDrawingBuffer',
 	CustomGlyphs = 'terminal.integrated.customGlyphs',
 	RescaleOverlappingGlyphs = 'terminal.integrated.rescaleOverlappingGlyphs',
 	PersistentSessionScrollback = 'terminal.integrated.persistentSessionScrollback',
diff --git a/src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts b/src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts
index 8428e99b5c4..d9360d24cb7 100644
--- a/src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts
+++ b/src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts
@@ -825,7 +825,8 @@ export class XtermTerminal extends Disposable implements IXtermTerminal, IDetach
 
 		const Addon = await this._xtermAddonLoader.importAddon('webgl');
 		this._webglAddon = new Addon({
-			customGlyphs: this._terminalConfigurationService.config.customGlyphs
+			customGlyphs: this._terminalConfigurationService.config.customGlyphs,
+			preserveDrawingBuffer: this._terminalConfigurationService.config.preserveDrawingBuffer
 		});
 		try {
 			this.raw.loadAddon(this._webglAddon);
diff --git a/src/vs/workbench/contrib/terminal/common/terminal.ts b/src/vs/workbench/contrib/terminal/common/terminal.ts
index 59d0532143f..61f0e4f4227 100644
--- a/src/vs/workbench/contrib/terminal/common/terminal.ts
+++ b/src/vs/workbench/contrib/terminal/common/terminal.ts
@@ -215,6 +215,7 @@ export interface ITerminalConfiguration {
 		fallbackLigatures: string[];
 	};
 	hideOnLastClosed: boolean;
+	preserveDrawingBuffer: boolean;
 }
 
 export interface ITerminalFont {
diff --git a/src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts b/src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts
index 7431c14b493..170e6e88720 100644
--- a/src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts
+++ b/src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts
@@ -564,6 +564,11 @@ const terminalConfiguration: IStringDictionary<IConfigurationPropertySchema> = {
 		type: 'boolean',
 		default: true
 	},
+	[TerminalSettingId.PreserveDrawingBuffer]: {
+		description: localize('terminal.integrated.preserveDrawingBuffer', "Whether to enable the preserveDrawingBuffer flag when creating the WebGL context."),
+		type: 'boolean',
+		default: false
+	},
 	[TerminalSettingId.CustomGlyphs]: {
 		markdownDescription: localize('terminal.integrated.customGlyphs', "Whether to draw custom glyphs instead of using the font for the following unicode ranges:\n\n{0}\n\nThis will typically result in better rendering with continuous lines, even when line height and letter spacing is used. This feature only works when {1} is enabled.", [
 			'- Box Drawing (U+2500-U+257F)',
